<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPS Game - Three.js</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Arial', sans-serif;
            cursor: none;
        }
        
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }
        
        #crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 2px solid #00ff00;
            border-radius: 50%;
            background: rgba(0, 255, 0, 0.3);
        }
        
        #hud {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: #00ff00;
            font-size: 18px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
        }
        
        #score {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #00ff00;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
        }
        
        #instructions {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #00ff00;
            font-size: 14px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            line-height: 1.4;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
        }
        
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #fff;
            z-index: 200;
        }
        
        #startButton {
            padding: 15px 30px;
            font-size: 20px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s;
            pointer-events: all;
        }
        
        #startButton:hover {
            background: #ff6666;
        }
        
        .muzzle-flash {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, #ffff00 0%, #ff8800 50%, transparent 100%);
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="startScreen">
            <h1 style="color: #00ff00; font-size: 48px; margin-bottom: 20px;">FPS ARENA</h1>
            <p style="font-size: 18px; margin-bottom: 10px;">WASD to move • Mouse to look • Click to shoot</p>
            <p style="font-size: 16px; color: #ffff00;">Destroy the red enemies to score points!</p>
            <button id="startButton">START GAME</button>
        </div>
        
        <div id="ui">
            <div id="crosshair"></div>
            <div id="hud">
                <div>Health: <span id="health">100</span></div>
                <div>Ammo: <span id="ammo">30</span></div>
            </div>
            <div id="score">Score: <span id="scoreValue">0</span></div>
            <div id="instructions">
                WASD: Move<br>
                Mouse: Look Around<br>
                Click: Shoot<br>
                R: Reload
            </div>
            <div class="muzzle-flash" id="muzzleFlash"></div>
        </div>
    </div>

    <script>
        // Game variables
        let scene, camera, renderer;
        let player, enemies = [], bullets = [], explosions = [];
        let gameStarted = false;
        let score = 0, health = 100, ammo = 30, maxAmmo = 30;
        let keys = {};
        let mouseX = 0, mouseY = 0;
        
        // Game settings
        const PLAYER_SPEED = 0.15;
        const ENEMY_SPEED = 0.03;
        const BULLET_SPEED = 0.8;
        const SPAWN_RATE = 0.015;
        
        // Initialize the game
        function init() {
            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x001133);
            scene.fog = new THREE.Fog(0x001133, 20, 80);
            
            // Create camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 2, 0);
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('gameContainer').appendChild(renderer.domElement);
            
            // Create environment
            createEnvironment();
            
            // Create player
            createPlayer();
            
            // Add lighting - Much brighter!
            const ambientLight = new THREE.AmbientLight(0x404040, 0.8);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.2);
            directionalLight.position.set(20, 20, 10);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 100;
            directionalLight.shadow.camera.left = -50;
            directionalLight.shadow.camera.right = 50;
            directionalLight.shadow.camera.top = 50;
            directionalLight.shadow.camera.bottom = -50;
            scene.add(directionalLight);
            
            // Add point lights for better visibility
            const pointLight1 = new THREE.PointLight(0x00ff00, 0.5, 30);
            pointLight1.position.set(10, 5, 10);
            scene.add(pointLight1);
            
            const pointLight2 = new THREE.PointLight(0xff0000, 0.5, 30);
            pointLight2.position.set(-10, 5, -10);
            scene.add(pointLight2);
            
            // Event listeners
            setupEventListeners();
            
            // Spawn initial enemies
            for (let i = 0; i < 3; i++) {
                setTimeout(() => createEnemy(), i * 1000);
            }
            
            // Start game loop
            animate();
        }
        
        function createEnvironment() {
            // Ground - brighter and more visible
            const groundGeometry = new THREE.PlaneGeometry(200, 200);
            const groundMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x444444,
                transparent: true,
                opacity: 0.8
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // Grid pattern on ground for better depth perception
            const gridHelper = new THREE.GridHelper(200, 40, 0x666666, 0x333333);
            scene.add(gridHelper);
            
            // Walls - brighter colors
            const wallMaterial = new THREE.MeshLambertMaterial({ color: 0x888888 });
            const wallGeometry = new THREE.BoxGeometry(2, 6, 2);
            
            // Create maze-like walls
            const wallPositions = [
                [-15, 0, -15], [15, 0, -15], [-15, 0, 15], [15, 0, 15],
                [0, 0, -20], [0, 0, 20], [-20, 0, 0], [20, 0, 0],
                [-8, 0, -8], [8, 0, 8], [-8, 0, 8], [8, 0, -8],
                [0, 0, -10], [0, 0, 10], [-10, 0, 0], [10, 0, 0]
            ];
            
            wallPositions.forEach(pos => {
                const wall = new THREE.Mesh(wallGeometry, wallMaterial);
                wall.position.set(pos[0], 3, pos[2]);
                wall.castShadow = true;
                wall.receiveShadow = true;
                scene.add(wall);
            });
            
            // Add bright decorative elements
            for (let i = 0; i < 15; i++) {
                const boxGeometry = new THREE.BoxGeometry(1, 1, 1);
                const boxMaterial = new THREE.MeshLambertMaterial({ 
                    color: new THREE.Color().setHSL(Math.random(), 0.8, 0.6),
                    emissive: new THREE.Color().setHSL(Math.random(), 0.5, 0.1)
                });
                const box = new THREE.Mesh(boxGeometry, boxMaterial);
                box.position.set(
                    (Math.random() - 0.5) * 60,
                    0.5,
                    (Math.random() - 0.5) * 60
                );
                box.castShadow = true;
                scene.add(box);
            }
        }
        
        function createPlayer() {
            player = {
                position: new THREE.Vector3(0, 2, 0),
                rotation: new THREE.Vector2(0, 0),
                velocity: new THREE.Vector3(0, 0, 0)
            };
        }
        
        function createEnemy() {
            const enemyGeometry = new THREE.BoxGeometry(1.5, 3, 1.5);
            const enemyMaterial = new THREE.MeshLambertMaterial({ 
                color: 0xff0000,
                emissive: 0x330000
            });
            const enemy = new THREE.Mesh(enemyGeometry, enemyMaterial);
            
            // Spawn at random position on the edge
            const angle = Math.random() * Math.PI * 2;
            const distance = 30 + Math.random() * 20;
            enemy.position.set(
                Math.cos(angle) * distance,
                1.5,
                Math.sin(angle) * distance
            );
            
            enemy.castShadow = true;
            enemy.health = 3;
            
            // Add a glowing effect
            const glowGeometry = new THREE.SphereGeometry(2, 8, 8);
            const glowMaterial = new THREE.MeshBasicMaterial({
                color: 0xff0000,
                transparent: true,
                opacity: 0.3
            });
            const glow = new THREE.Mesh(glowGeometry, glowMaterial);
            enemy.add(glow);
            
            scene.add(enemy);
            enemies.push(enemy);
        }
        
        function createBullet(position, direction) {
            const bulletGeometry = new THREE.SphereGeometry(0.1, 8, 8);
            const bulletMaterial = new THREE.MeshBasicMaterial({ 
                color: 0xffff00,
                emissive: 0xffff00
            });
            const bullet = new THREE.Mesh(bulletGeometry, bulletMaterial);
            
            bullet.position.copy(position);
            bullet.velocity = direction.clone().multiplyScalar(BULLET_SPEED);
            bullet.life = 150;
            
            scene.add(bullet);
            bullets.push(bullet);
        }
        
        function createExplosion(position) {
            for (let i = 0; i < 10; i++) {
                const particleGeometry = new THREE.SphereGeometry(0.2, 6, 6);
                const particleMaterial = new THREE.MeshBasicMaterial({ 
                    color: new THREE.Color().setHSL(0.1, 1, 0.5 + Math.random() * 0.5),
                    transparent: true,
                    opacity: 0.8
                });
                const particle = new THREE.Mesh(particleGeometry, particleMaterial);
                
                particle.position.copy(position);
                particle.velocity = new THREE.Vector3(
                    (Math.random() - 0.5) * 0.3,
                    Math.random() * 0.3,
                    (Math.random() - 0.5) * 0.3
                );
                particle.life = 30;
                
                scene.add(particle);
                explosions.push(particle);
            }
        }
        
        function setupEventListeners() {
            // Keyboard events
            document.addEventListener('keydown', (event) => {
                keys[event.code] = true;
                if (event.code === 'KeyR') {
                    reload();
                }
            });
            
            document.addEventListener('keyup', (event) => {
                keys[event.code] = false;
            });
            
            // Mouse events
            document.addEventListener('mousemove', (event) => {
                if (!gameStarted) return;
                
                mouseX -= event.movementX * 0.002;
                mouseY -= event.movementY * 0.002;
                mouseY = Math.max(-Math.PI/2, Math.min(Math.PI/2, mouseY));
            });
            
            document.addEventListener('click', (event) => {
                if (!gameStarted) return;
                shoot();
            });
            
            // Start button
            document.getElementById('startButton').addEventListener('click', startGame);
            
            // Pointer lock
            document.addEventListener('click', () => {
                if (gameStarted) {
                    renderer.domElement.requestPointerLock();
                }
            });
            
            // Window resize
            window.addEventListener('resize', onWindowResize);
        }
        
        function startGame() {
            gameStarted = true;
            document.getElementById('startScreen').style.display = 'none';
            renderer.domElement.requestPointerLock();
        }
        
        function shoot() {
            if (ammo <= 0) return;
            
            ammo--;
            updateHUD();
            
            // Muzzle flash
            const muzzleFlash = document.getElementById('muzzleFlash');
            muzzleFlash.style.opacity = '1';
            setTimeout(() => {
                muzzleFlash.style.opacity = '0';
            }, 100);
            
            // Create bullet
            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(camera.quaternion);
            
            createBullet(camera.position.clone(), direction);
        }
        
        function reload() {
            ammo = maxAmmo;
            updateHUD();
        }
        
        function updatePlayer() {
            // Movement
            const moveVector = new THREE.Vector3();
            
            if (keys['KeyW']) moveVector.z -= 1;
            if (keys['KeyS']) moveVector.z += 1;
            if (keys['KeyA']) moveVector.x -= 1;
            if (keys['KeyD']) moveVector.x += 1;
            
            if (moveVector.length() > 0) {
                moveVector.normalize();
                moveVector.multiplyScalar(PLAYER_SPEED);
                moveVector.applyQuaternion(camera.quaternion);
                moveVector.y = 0; // No flying
                
                player.position.add(moveVector);
            }
            
            // Update camera
            camera.position.copy(player.position);
            camera.rotation.x = mouseY;
            camera.rotation.y = mouseX;
        }
        
        function updateEnemies() {
            // Spawn new enemies
            if (Math.random() < SPAWN_RATE && enemies.length < 8) {
                createEnemy();
            }
            
            enemies.forEach((enemy, index) => {
                // Move towards player
                const direction = new THREE.Vector3();
                direction.subVectors(player.position, enemy.position);
                direction.y = 0;
                direction.normalize();
                direction.multiplyScalar(ENEMY_SPEED);
                
                enemy.position.add(direction);
                
                // Rotate enemy
                enemy.rotation.y += 0.02;
                
                // Check collision with player
                const distance = enemy.position.distanceTo(player.position);
                if (distance < 3) {
                    health -= 0.5;
                    updateHUD();
                    
                    if (health <= 0) {
                        gameOver();
                    }
                }
            });
        }
        
        function updateBullets() {
            bullets.forEach((bullet, bulletIndex) => {
                bullet.position.add(bullet.velocity);
                bullet.life--;
                
                // Remove old bullets
                if (bullet.life <= 0) {
                    scene.remove(bullet);
                    bullets.splice(bulletIndex, 1);
                    return;
                }
                
                // Check collision with enemies
                enemies.forEach((enemy, enemyIndex) => {
                    const distance = bullet.position.distanceTo(enemy.position);
                    if (distance < 2) {
                        // Hit enemy
                        enemy.health--;
                        
                        // Remove bullet
                        scene.remove(bullet);
                        bullets.splice(bulletIndex, 1);
                        
                        if (enemy.health <= 0) {
                            // Destroy enemy
                            createExplosion(enemy.position);
                            scene.remove(enemy);
                            enemies.splice(enemyIndex, 1);
                            score += 100;
                            updateHUD();
                        }
                    }
                });
            });
        }
        
        function updateExplosions() {
            explosions.forEach((explosion, index) => {
                explosion.life--;
                explosion.position.add(explosion.velocity);
                explosion.material.opacity *= 0.95;
                explosion.scale.multiplyScalar(0.98);
                
                if (explosion.life <= 0) {
                    scene.remove(explosion);
                    explosions.splice(index, 1);
                }
            });
        }
        
        function updateHUD() {
            document.getElementById('health').textContent = Math.max(0, Math.floor(health));
            document.getElementById('ammo').textContent = ammo;
            document.getElementById('scoreValue').textContent = score;
        }
        
        function gameOver() {
            alert(`Game Over! Final Score: ${score}\n\nClick OK to restart.`);
            location.reload();
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (gameStarted) {
                updatePlayer();
                updateEnemies();
                updateBullets();
                updateExplosions();
            }
            
            renderer.render(scene, camera);
        }
        
        // Initialize the game
        init();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97af256330841fe1',t:'MTc1NzE3NDA3OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
